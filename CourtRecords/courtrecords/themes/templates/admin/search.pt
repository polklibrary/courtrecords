<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
  
    <tal:block metal:define-slot="title">
        <title>Quick Search</title>
    </tal:block>  
    <link rel="stylesheet" type="text/css" href="${request.static_url('courtrecords:themes/plugins/datatables/jquery.dataTables.css')}" />
    <link rel="stylesheet" type="text/css" href="${request.static_url('courtrecords:themes/plugins/jquery/jquery-ui.css')}" />
    <link rel="stylesheet" type="text/css" href="${request.static_url('courtrecords:themes/css/manage.css')}" />
    <script type="text/javascript">
        var domain = '${request.application_url}';
    </script>
    <script type="text/javascript" src="${request.static_url('courtrecords:themes/plugins/jquery/jquery.js')}"></script>
    <script type="text/javascript" src="${request.static_url('courtrecords:themes/plugins/datatables/jquery.dataTables.min.js')}"></script>
    <script type="text/javascript" src="${request.static_url('courtrecords:themes/js/manage.js')}"></script>
    <script>
        $(document).ready(function(){
            var results_table = null;

            var go_search = function() {
                var query = {'everything': $('#for-everything').val(),
                             'keywords': $('#for-keywords').val() }
            
                QuickSearch.quick( query, function(data){
                  
                    if (results_table != null) {
                        results_table.clear();
                        results_table.destroy();
                        $('#quick-search-results table tbody').html('');
                    }
                        
                    for(var i in data) {

                        console.log(data[i].case.id);
                        var tr = $('<tr>').attr('data-id',data[i].case.id).click(function(){
                            console.log(data[i].case.id);
                            window.parent.location.href = window.domain + '/manage/records/' + $(this).attr('data-id');
                        });
                        var entity = $('<td>').append( data[i].entity.entity + ', ' + data[i].entity.firstname + ' ' + data[i].entity.middlename);
                        var year = $('<td>').append( data[i].case.year_text);
                        var county = $('<td>').append( data[i].county.county);
                        var actiontype = $('<td>').append( data[i].actiontype.actiontype);
                        var id = $('<td>').append(data[i].case.id);
                        $(tr).append(entity).append(year).append(county).append(actiontype).append(id);
                        
                        $('#quick-search-results table tbody').append(tr);

                    }
                    
                    results_table = $("#quick-search-results table").DataTable({
                        'processing': false,
                        'serverSide': false,
                        'searching': false,
                        'lengthChange': false,
                        'pageLength': 10,
                        'paging': true,
                    }); 
                    
                    if (data.length > 0)  {
                        $('#quick-search-results').show();
                        $('#no-quick-search-results').hide();
                    } else {
                        $('#quick-search-results').hide();
                        $('#no-quick-search-results').show();
                    }
                    
                    QuickSearch.update();
                } );
            }
                
                
            
            $('input[type="text"]').keypress(function(e) {
                if (e.keyCode == 13) {
                   go_search();
                }
            });
            
            $('input[type="button"]').click(function() {
                   go_search();
            });
         

         
        });
    </script>
       
</head>
<body class="quick-search">
    <h2>Quick Search</h2>
    <br />
    
    <div>
        <label for="for-everything">Name or address:</label>
        <input id="for-everything" type="text" value="" name="search.Form.everything" />
    </div>
    
    <div>
        <label for="for-keywords">Notes:</label>
        <input id="for-keywords" type="text" value="" name="search.Form.keywords" />
    </div>
    
    <br />
    
    <div class="right">
        <input class="button" type="button" value="Search" name="search.Form.submit" />
    </div>
    <div class="clear"></div>
    
    <div id="quick-search-results" class="hide">
        <table class="dt-generic-style">
            <thead>
                <tr>
                    <th>Entity</th>
                    <th>Year</th>
                    <th>County</th>
                    <th>ActionType</th>
                    <th>ID</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <div id="no-quick-search-results" class="hide">
        No results found
    </div>

</body>
</html>

        