<metal:page
    xmlns:tal="http://xml.zope.org/namespaces/tal"
    xmlns:metal="http://xml.zope.org/namespaces/metal"
    use-macro="load: master.pt">
    
    
    <tal:block metal:fill-slot="css">
        <link rel="stylesheet" type="text/css" href="${request.static_url('courtrecords:themes/plugins/datatables/jquery.dataTables.css')}" />
        <link rel="stylesheet" type="text/css" href="${request.static_url('courtrecords:themes/plugins/jquery/jquery-ui.css')}" />
    </tal:block>
    
    <tal:block metal:fill-slot="js">
        <script type="text/javascript" src="${request.static_url('courtrecords:themes/plugins/jquery/jquery-ui.js')}"></script>
        <script type="text/javascript" src="${request.static_url('courtrecords:themes/plugins/datatables/jquery.dataTables.min.js')}"></script>
        <script type="text/javascript" src="${request.static_url('courtrecords:themes/plugins/validators/jquery.masked.inputs.js')}"></script>
        <script>

            $(document).ready(function(){
            
                var update_cost = function() {
                    var total = 0.0;
                    $('.record-cost').each(function() {
                        total += parseFloat($(this).html().replace('$',''));
                    });
                    
                    $('.total-cost-updater').html('$' + total.toFixed(2));
                }
            
            
                // reset fields in case of refresh.
                $('input[name="customer.agreement"]').prop('checked',false);
                $('#checkout-mail').prop('checked',false);
                $('#checkout-digital').prop('checked',false);
                
                // Show Steps
                $('input[name="customer.agreement"]').change(function(){
                    $('#step2').show();
                });
                $('#checkout-mail,#checkout-digital').change(function(){
                    //if ($('#checkout-mail').is(':checked')) {
                    //    $('#toggle-address').show();
                    //    $('#customer-address, #customer-address2').prop('required',true);
                    //} else {
                    //    $('#toggle-address').hide();
                    //    $('#customer-address, #customer-address2').prop('required',false);
                    //}    
                    
                    $('#step3').show();
                });
                
                $('input[type="button"]').click(function(){
                    $(this).parents('.irecord').remove();
                    var id = $(this).attr('data-id');
                    Basket.remove(id);
                    update_cost();
                });
                
                $('#customer-phone').mask("999-999-9999");
                
                
            });
        </script>
    </tal:block>
     
    <tal:block metal:fill-slot="breadcrumbs">
        <div id="breadcrumbs">
            <a href="http://www.uwosh.edu/archives">Archives &amp; ARC</a>
            <span>&#9002;</span>
            <a href="${request.application_url}">Court Records</a>
            <span>&#9002;</span>
            <a href="${request.application_url}/search">Search</a>
            <span>&#9002;</span>
            <a href="${request.application_url}/basket">Checkout</a>
        </div>
    </tal:block>
     
    <tal:block metal:fill-slot="content">

    
        <div class="column">
    
            <div tal:condition="not: records">
                 Your cart is empty
            </div>
            
            <form id="basket" action="${request.application_url}/basket" method="post" tal:condition="records">
            
                <div class="steps">
                    <h2>Step 1: Review records in your cart</h2>
                    <div id="basket-results">
                    
                        <!--<h3>Records in your cart</h3>-->
                        
                        <tal:block repeat="record records">
                            <div class="irecord">
                                <iframe src="" data-src="${request.application_url}/record/${record.id}"></iframe>
                                
                                <div class="cost">
                                    <span>Record price: <span class="record-cost">${record.price}</span></span>
                                    &nbsp;
                                    &nbsp;
                                    <input type="hidden" name="records" value="${record.id}" />
                                    <input type="button" class="button red" data-id="${record.id}" value="Remove from cart" />
                                </div>
                                
                            </div>
                        </tal:block>
                        <script type="text/javascript" >
                            $('iframe').each(function(){
                                resizeIframe(this,null,false);
                                autoResize(this,null,false);
                            });
                        </script>
                        <div class="total-cost">
                            Total Price: <span class="total-cost-updater">${total_price}</span>
                        </div>
                        
                    </div>
                    
                    <br />
                    
                    <label id="agreement">
                        <input type="checkbox" name="customer.agreement" value="1" /> 
                        By checking this box you agree to be billed <span class="total-cost-updater">${total_price}</span> for the discovery, photocopy reproduction and 
                        delivery of the requested records. 
                    </label> 
                    
                    <br />
                    
                </div>
                
                <br />
                
                <div id="step2" class="hide steps">
                    <h2>Step 2: Select Delivery Option</h2>
                    
                    <label for="checkout-mail">Mail me a physical copy:</label> <input id="checkout-mail" type="checkbox" name="customer.checkout" value="physically" />
                    <br />
                    <label for="checkout-digital">Email me a digital copy:</label> <input id="checkout-digital"  type="checkbox" name="customer.checkout" value="digitally" />
                    
                    <br />
                    <br />
                    
                </div>
                
                <br />
                
                <div id="step3" class="hide steps">
                    <h2>Final Step: Your Information</h2>
                    
                    <label for="customer-name">Full name:</label> <input id="customer-name" type="text" name="customer.name" value="" required="true"/> <span class="required">* required</span>
                    
                    <br />
                    <br />
                    
                    <label for="customer-email">Email:</label> <input id="customer-email" type="text" name="customer.email" value="" required="true"/> <span class="required">* required</span>
                    
                    <br />
                    <br />
                    
                    <label for="customer-address">Address: </label> 
                    <input id="customer-address" type="text" name="customer.address" required="true" /> <span class="required">* required</span>                   
                    <br />
                    <br />
                    <label for="customer-address2">City, State and Zip: </label> 
                    <input id="customer-address2" type="text" name="customer.address2" required="true" /> <span class="required">* required</span>
                    
                    <br />
                    <br />
                    
                    <label for="customer-phone">Phone number:</label> <input id="customer-phone" type="text" name="customer.phone" value="" /> 
                    
                    <br />
                    <br />
                    
                    <div id="checkout">
                        <input class="button green" type="submit" name="submit" value="Submit Order" />
                    </div>
                    
                    <div>
                        ${message_before_ordering}
                    </div>
                    
                </div>
                
            </form>
        </div>
        
    </tal:block>
     
</metal:page>